<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIALAN – Home</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.css" rel="stylesheet">
<style>
body { font-family:"Inter", sans-serif; background-color:#fdfdfd; color:#2c3e50; margin:0; padding:0; }
footer { text-align:center; padding:20px 0; font-size:0.9rem; color:#6c757d; border-top:1px solid #e9ecef; background: linear-gradient(90deg,#ffffff,#f8f8f8); box-shadow: 0 -2px 6px rgba(0,0,0,0.04); }
section.container { background-color:#ffffff; border-radius:15px; padding:30px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
.btn-phoenix { font-weight:600; border-radius:12px; padding:0.6rem 1.4rem; margin-right:10px; cursor:pointer; border:none; transition: all 0.25s ease-in-out; color:#fff; box-shadow: 0 6px 18px rgba(0,0,0,0.08);}
.btn-login { background: linear-gradient(145deg,#6c63ff,#5a54d1);}
.btn-login:hover { transform: translateY(-2px); box-shadow:0 8px 22px rgba(0,0,0,0.12);}
.badge-status { font-weight:600; margin-right:0.5rem; }
#barChart { box-shadow:0 10px 20px rgba(0,0,0,0.08); border-radius:12px; }
</style>
</head>
<body>

<div id="navbar"></div>

<section class="container my-4">
  <h2 class="mb-4">Statistik Siswa Tuntas / Ujian per Mata Pelajaran</h2>
  <canvas id="barChart" height="150"></canvas>
  <div id="statusBadges" class="mt-3"></div>
</section>

<footer>
  © 2025 SIALAN – Sistem Analisis Laporan KBM Siswa
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

<script>
// Load Navbar
fetch('navbar_publik.html')
  .then(resp => resp.text())
  .then(html => document.getElementById('navbar').innerHTML = html)
  .then(()=> feather.replace());

// ===== Fetch CSV Data =====
async function fetchSheetData() {
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQAEwBLEhaehGYlzYsNhBPfmozGvRZmpjyEOHC8rfgduB0JRurz-xwI_jfW8Fw8Vaz93a_E9tLyuIX9/pub?gid=0&single=true&output=csv";
  const res = await fetch(url);
  const csvText = await res.text();
  const lines = csvText.split("\n").filter(l=>l.trim()!=="");
  const headers = lines[0].split(",");
  return lines.slice(1).map(line=>{
    const vals = line.split(",");
    const obj = {};
    headers.forEach((h,i)=>obj[h.trim()]=vals[i].trim());
    return obj;
  });
}

// ===== Render Chart per Mapel =====
fetchSheetData().then(data=>{
  const mapelLabels = [...new Set(data.map(d=>d.Mata_Pelajaran))];
  const tuntasData = mapelLabels.map(mp => data.filter(d=>d.Mata_Pelajaran===mp && d.Status==="Tuntas").length);
  const ujianData  = mapelLabels.map(mp => data.filter(d=>d.Mata_Pelajaran===mp && d.Status==="Ujian").length);

  const ctx = document.getElementById('barChart').getContext('2d');
  new Chart(ctx, {
    type:'bar',
    data:{
      labels: mapelLabels,
      datasets:[
        {label:'Tuntas', data:tuntasData, backgroundColor:'#198754', borderRadius:8, borderSkipped:false},
        {label:'Ujian',  data:ujianData,  backgroundColor:'#dc3545', borderRadius:8, borderSkipped:false}
      ]
    },
    options:{
      responsive:true,
      plugins:{
        title:{
          display:true,
          text:'Jumlah Siswa Tuntas / Ujian per Mata Pelajaran',
          font:{size:18, weight:'bold'}
        },
        legend:{position:'top'},
        tooltip:{
          mode:'index',
          intersect:false,
          callbacks:{
            label: context => `${context.dataset.label}: ${context.parsed.y} siswa`
          }
        },
        datalabels:{
          anchor:'end',
          align:'end',
          color:'#000',
          font:{weight:'bold'},
          formatter:value => value > 0 ? value : ''
        }
      },
      interaction:{mode:'nearest', axis:'x', intersect:false},
      scales:{
        x:{stacked:true, grid:{display:false}},
        y:{stacked:true, beginAtZero:true, ticks:{stepSize:1}}
      },
      animation:{duration:1000, easing:'easeOutQuart'}
    },
    plugins:[ChartDataLabels]
  });

  // Badge Status
  const totalTuntas = data.filter(d=>d.Status==="Tuntas").length;
  const totalUjian   = data.filter(d=>d.Status==="Ujian").length;
  document.getElementById('statusBadges').innerHTML=
    `<span class="badge bg-success badge-status">Tuntas: ${totalTuntas}</span>
     <span class="badge bg-danger badge-status">Ujian: ${totalUjian}</span>`;
});
</script>

</body>
</html>
